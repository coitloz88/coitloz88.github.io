<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Pytorch tutorials 02 Dataset과 DataLoader" /><meta property="og:locale" content="en" /><meta name="description" content="데이터셋 코드는 더 나은 가독성과 모듈성을 위해 모델 학습 코드로부터 분리하는 것이 좋다. Pytorch에서는 torch.utils.data.DataLoader와 torch.utils.data.Dataset의 두 가지 데이터 기본 요소를 통해 미리 준비된(pre-loaded) 데이터 셋은 물론 가지고 있는 데이터를 사용할 수도 있다. Dataset은 샘플과 정답(label)을 저장하고, DataLoader는 Dataset을 샘플에 쉽게 접근할 수 있도록 순회 가능한 객체(iterable)로 감싼다." /><meta property="og:description" content="데이터셋 코드는 더 나은 가독성과 모듈성을 위해 모델 학습 코드로부터 분리하는 것이 좋다. Pytorch에서는 torch.utils.data.DataLoader와 torch.utils.data.Dataset의 두 가지 데이터 기본 요소를 통해 미리 준비된(pre-loaded) 데이터 셋은 물론 가지고 있는 데이터를 사용할 수도 있다. Dataset은 샘플과 정답(label)을 저장하고, DataLoader는 Dataset을 샘플에 쉽게 접근할 수 있도록 순회 가능한 객체(iterable)로 감싼다." /><link rel="canonical" href="https://coitloz88.github.io/posts/pytorch-tutorial-2/" /><meta property="og:url" content="https://coitloz88.github.io/posts/pytorch-tutorial-2/" /><meta property="og:site_name" content="Devlog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-10T13:55:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Pytorch tutorials 02 Dataset과 DataLoader" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-10T13:55:00+09:00","datePublished":"2022-05-10T13:55:00+09:00","description":"데이터셋 코드는 더 나은 가독성과 모듈성을 위해 모델 학습 코드로부터 분리하는 것이 좋다. Pytorch에서는 torch.utils.data.DataLoader와 torch.utils.data.Dataset의 두 가지 데이터 기본 요소를 통해 미리 준비된(pre-loaded) 데이터 셋은 물론 가지고 있는 데이터를 사용할 수도 있다. Dataset은 샘플과 정답(label)을 저장하고, DataLoader는 Dataset을 샘플에 쉽게 접근할 수 있도록 순회 가능한 객체(iterable)로 감싼다.","headline":"Pytorch tutorials 02 Dataset과 DataLoader","mainEntityOfPage":{"@type":"WebPage","@id":"https://coitloz88.github.io/posts/pytorch-tutorial-2/"},"url":"https://coitloz88.github.io/posts/pytorch-tutorial-2/"}</script><title>Pytorch tutorials 02 | Dataset과 DataLoader | Devlog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Devlog"><meta name="application-name" content="Devlog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/profileIMG.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Devlog</a></div><div class="site-subtitle font-italic">CS Study Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/coitloz88" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.acmicpc.net/user/coitloz32" aria-label="baekjoon" target="_blank" rel="noopener"> <i class="fas fa-code"></i> </a> <a href="https://coitloz88.notion.site/Profile-Hyemin-Lee-9e2a275d08d04ae48685d02ec1ccc651" aria-label="notion" target="_blank" rel="noopener"> <i class="fas fa-book"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cotloz88','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Pytorch tutorials 02 | Dataset과 DataLoader</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Pytorch tutorials 02 | Dataset과 DataLoader</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/coitloz88">coitloz88</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1652158500" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-10 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="982 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><p>데이터셋 코드는 더 나은 가독성과 모듈성을 위해 모델 학습 코드로부터 분리하는 것이 좋다.<br /> Pytorch에서는 <code class="language-plaintext highlighter-rouge">torch.utils.data.DataLoader</code>와 <code class="language-plaintext highlighter-rouge">torch.utils.data.Dataset</code>의 두 가지 데이터 기본 요소를 통해 미리 준비된(pre-loaded) 데이터 셋은 물론 가지고 있는 데이터를 사용할 수도 있다.<br /> <code class="language-plaintext highlighter-rouge">Dataset</code>은 샘플과 정답(label)을 저장하고, <code class="language-plaintext highlighter-rouge">DataLoader</code>는 <code class="language-plaintext highlighter-rouge">Dataset</code>을 샘플에 쉽게 접근할 수 있도록 순회 가능한 객체(iterable)로 감싼다.</p><p><br /></p><hr /><p><br /></p><h1 id="데이터셋-불러오기">데이터셋 불러오기</h1><p><em>TorchVision</em>에서 [FashionMNIST] 데이터셋을 불러오는 예제를 살펴보자.</p><ul><li><code class="language-plaintext highlighter-rouge">root</code>: 학습/테스트 데이터가 저장되는 경로<li><code class="language-plaintext highlighter-rouge">train</code>: 학습용 또는 테스트 데이터셋 여부를 지정<li><code class="language-plaintext highlighter-rouge">download=True</code>: <code class="language-plaintext highlighter-rouge">root</code>에 데이터가 없는 경우 인터넷에서 다운로드<li><code class="language-plaintext highlighter-rouge">transform</code>과 <code class="language-plaintext highlighter-rouge">target_transform</code>: feature과 label transform을 지정</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">torchvision.transforms</span> <span class="kn">import</span> <span class="n">ToTensor</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">training_data</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">.</span><span class="n">FashionMNIST</span><span class="p">(</span>
    <span class="n">root</span> <span class="o">=</span> <span class="s">"data"</span><span class="p">,</span>
    <span class="n">train</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">download</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">ToTensor</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">test_data</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">.</span><span class="n">FashionMNIST</span><span class="p">(</span>
    <span class="n">root</span> <span class="o">=</span> <span class="s">"data"</span><span class="p">,</span>
    <span class="n">train</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">download</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">ToTensor</span><span class="p">()</span>
<span class="p">)</span>
</pre></table></code></div></div><p><br /></p><hr /><p><br /></p><h1 id="데이터-셋을-순회하고-시각화하기">데이터 셋을 순회하고 시각화하기</h1><p><code class="language-plaintext highlighter-rouge">Dataset</code>에 List처럼 직접 접근(index)할 수 있다.</p><ul><li>예: <code class="language-plaintext highlighter-rouge">training_data[index]</code></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="n">labels_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s">"T-Shirt"</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s">"Trouser"</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s">"Pullover"</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s">"Dress"</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s">"Coat"</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s">"Sandal"</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s">"Shirt"</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s">"Sneaker"</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s">"Bag"</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="s">"Ankle Boot"</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">cols</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span> <span class="o">*</span> <span class="n">rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">sample_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">training_data</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)).</span><span class="n">item</span><span class="p">()</span>
    <span class="n">img</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">training_data</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span>
    <span class="n">figure</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="n">labels_map</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">"off"</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">"gray"</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><br /></p><hr /><p><br /></p><h1 id="파일에서-사용자-정의-데이터셋-만들기">파일에서 사용자 정의 데이터셋 만들기</h1><p>사용자 정의 Dataset 클래스는 반드시 3개의 함수를 구현해야 한다.</p><ol><li><p><code class="language-plaintext highlighter-rouge">__init__</code> Dataset 객체가 생성(instantiate)될 때 한 번만 실행된다.</p><li><p><code class="language-plaintext highlighter-rouge">__len__</code> 데이터셋의 샘플 개수를 반환한다.</p><li><p><code class="language-plaintext highlighter-rouge">__getitem__</code> 주어진 인덱스 <code class="language-plaintext highlighter-rouge">idx</code>에 해당하는 샘플을 데이터셋에서 불러오고 반환한다. 인덱스를 기반으로, 디스크에서 이미지의 위치를 식별하고, <code class="language-plaintext highlighter-rouge">read_image</code>를 사용하여 이미지를 텐서로 변환하고, <code class="language-plaintext highlighter-rouge">self.img_labels</code>의 csv 데이터로부터 해당하는 정답(label)을 가져오고, 해당되는 경우 변형(transform) 함수들을 호출한 뒤, 텐서 이미지와 라벨을 Python 사전(dict)형으로 반환한다.</p></ol><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">torchvision.io</span> <span class="kn">import</span> <span class="n">read_image</span>

<span class="k">class</span> <span class="nc">CustomImageDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotations_file</span><span class="p">,</span> <span class="n">img_dir</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">target_transform</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">img_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">annotations_file</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'file_name'</span><span class="p">,</span> <span class="s">'label'</span><span class="p">])</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">img_dir</span> <span class="o">=</span> <span class="n">img_dir</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">target_transform</span> <span class="o">=</span> <span class="n">target_transform</span>
    
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">img_labels</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">img_dir</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">img_labels</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">read_image</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">img_labels</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_transform</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_transform</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">label</span>
</pre></table></code></div></div><p><br /></p><hr /><p><br /></p><h1 id="dataloader로-학습용-데이터-준비하기">DataLoader로 학습용 데이터 준비하기</h1><p><code class="language-plaintext highlighter-rouge">Dataset</code>은 데이터셋의 feature을 가져오고, 하나의 샘플에 label을 지정하는 일을 한 번에 수행한다.<br /> 모델을 학습할 때, 일반적으로 샘플들을 minibatch로 전달하고, 매 epoch마다 데이터를 다시 섞어서 overfit을 막는다. 또한, Python의 <code class="language-plaintext highlighter-rouge">multiprocessing</code>을 사용하여 데이터 검색 속도를 높인다.</p><p><code class="language-plaintext highlighter-rouge">DataLoader</code>는 간단한 API로, 이러한 복잡한 과정을 추상화한 순회 가능한 객체(iterable)이다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>

<span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">training_data</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">test_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></table></code></div></div><p><br /></p><hr /><p><br /></p><h1 id="dataloader를-통해-순회하기iterate">DataLoader를 통해 순회하기(iterate)</h1><p><code class="language-plaintext highlighter-rouge">DataLoader</code>에 데이터 셋을 불러오고 나서는, 필요에 따라 데이터 셋을 순회(iterate)할 수 있다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1"># 이미지와 정답(label)을 표시한다.
</span><span class="n">train_features</span><span class="p">,</span> <span class="n">train_label</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Feature batch shape: </span><span class="si">{</span><span class="n">train_features</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Labels batch shape: </span><span class="si">{</span><span class="n">train_labels</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">train_features</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">train_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">"gray"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Label: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><p><br /></p><hr /><p><br /></p><h1 id="references">References</h1><ul><li><a href="https://tutorials.pytorch.kr/beginner/basics/data_tutorial.html">https://tutorials.pytorch.kr/beginner/basics/data_tutorial.html</a><li><a href="https://wikidocs.net/32829">https://wikidocs.net/32829</a><li><a href="https://gooopy.tistory.com/68">https://gooopy.tistory.com/68</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ml/'>ML</a>, <a href='/categories/pytorch/'>pytorch</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ml/" class="post-tag no-text-decoration" >ML</a> <a href="/tags/pytorch/" class="post-tag no-text-decoration" >pytorch</a> <a href="/tags/tutorial/" class="post-tag no-text-decoration" >tutorial</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Pytorch tutorials 02 | Dataset과 DataLoader - Devlog&amp;url=https://coitloz88.github.io/posts/pytorch-tutorial-2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Pytorch tutorials 02 | Dataset과 DataLoader - Devlog&amp;u=https://coitloz88.github.io/posts/pytorch-tutorial-2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://coitloz88.github.io/posts/pytorch-tutorial-2/&amp;text=Pytorch tutorials 02 | Dataset과 DataLoader - Devlog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/backend-2/">웹 백엔드 1-2 Maven 및 기초 환경 세팅</a><li><a href="/posts/pytorch-tutorial-6/">Pytorch tutorials 06 | 모델 매개변수 최적화하기</a><li><a href="/posts/baekjoon11729/">백준 11729</a><li><a href="/posts/pytorch-tutorial-4/">Pytorch tutorials 04 | 신경망 모델 구성하기</a><li><a href="/posts/pytorch-tutorial-1/">Pytorch tutorials 01 | Tensor</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/ml/">ML</a> <a class="post-tag" href="/tags/pytorch/">pytorch</a> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/codelab/">codelab</a> <a class="post-tag" href="/tags/computer/">computer</a> <a class="post-tag" href="/tags/baekjoon/">baekjoon</a> <a class="post-tag" href="/tags/flask/">flask</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/pytorch-tutorial-4/"><div class="card-body"> <em class="timeago small" data-ts="1652316000" > 2022-05-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pytorch tutorials 04 | 신경망 모델 구성하기</h3><div class="text-muted small"><p> 신경망은 데이터 연산을 수행하는 layer / module로 구성되어있다. torch.nn 네임스페이스는 신경망을 구성하는데 필요한 모든 구성 요소를 제공한다. FashionMNIST 데이터셋의 이미지를 분류하는 신경망을 구성해보자. 1 2 3 4 5 import os import torch from torch import nn from tor...</p></div></div></a></div><div class="card"> <a href="/posts/pytorch-tutorial-5/"><div class="card-body"> <em class="timeago small" data-ts="1652454660" > 2022-05-14 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pytorch tutorials 05 | TORCH.AUTOGRAD를 사용한 자동 미분</h3><div class="text-muted small"><p> 신경망을 학습할 때 가장 자주 사용되는 알고리즘인 Back Propagation에서, 매개변수(weight과 bias)는 주어진 매개변수에 대한 Error function의 Gradient에 따라 조정된다. 이를 위해 Pytorch에 내장되어 있는 자동 미분 엔진 torch.autograd를 사용한다. Input x, Weight w, Bias b...</p></div></div></a></div><div class="card"> <a href="/posts/pytorch-tutorial-6/"><div class="card-body"> <em class="timeago small" data-ts="1652857200" > 2022-05-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pytorch tutorials 06 | 모델 매개변수 최적화하기</h3><div class="text-muted small"><p> 이때까지의 과정을 통해 모델과 데이터를 준비했다. 이제는 데이터에 매개변수를 최적화하여 모델을 학습하고, 검증(평가)하고, 테스트할 차례이다. 모델을 학습하는 과정은 다음과 같은 반복적인 과정(epoch)을 거친다. 모델은 출력을 추측한다. 추측과 실제 정답 사이의 오류(loss)를 계산한다. 매개변수에 대한 오류의 도함수를 수집하고,...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/pytorch-tutorial-1/" class="btn btn-outline-primary" prompt="Older"><p>Pytorch tutorials 01 | Tensor</p></a> <a href="/posts/baekjoon11729/" class="btn btn-outline-primary" prompt="Newer"><p>백준 11729</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/coitloz88">coitloz88</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/ml/">ML</a> <a class="post-tag" href="/tags/pytorch/">pytorch</a> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/codelab/">codelab</a> <a class="post-tag" href="/tags/computer/">computer</a> <a class="post-tag" href="/tags/baekjoon/">baekjoon</a> <a class="post-tag" href="/tags/flask/">flask</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
